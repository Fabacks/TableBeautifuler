/**
 * TableBeautifuller
 * 
 * Author: Fabacks
 * License: Free distribution except for commercial use
 * GitHub Repository: https://github.com/Fabacks/TableBeautifuller
 * Version 0.8.1
 * 
 * This software is provided "as is" without any warranty. The author is
 * not responsible for any damages or liabilities caused by the use of this software.
 * Please do not use this software for commercial purposes without explicit permission from the author.
 * If you use or distribute this software, please credit the author and link back to the GitHub repository.
 */

class TableBeautifuller{constructor(t,e={}){this.table=document.querySelector(t),this.displayBloc={},this.displayBloc.info=e.info??!0,this.displayBloc.ordering=e.ordering??!0,this.displayBloc.paging=e.paging??!0,this.displayBloc.searching=e.searching??!0,this.displayBloc.columnSearch=e.columnSearch??!0;let a=e.order||this.table.getAttribute("data-order");"string"==typeof a?this.initialOrder=JSON.parse(a):Array.isArray(a)?this.initialOrder=a:this.initialOrder=[],this.pageLength=e.pageLength||parseInt(this.table.getAttribute("data-page-length"))||10,this.currentPage=1,this.selectItemPage=e.selectItemPage||[10,20,30],this.selectItemPage.includes(this.pageLength)||(this.selectItemPage.push(this.pageLength),this.selectItemPage.sort(((t,e)=>t-e))),this.debounce_delai=e.debounceDelai||300,this.filters={},this.createWrappers(),this.displayBloc.searching&&this.addSearchInput(),this.displayBloc.ordering&&(this.addSortingArrows(),this.applyInitialOrder()),this.displayBloc.columnSearch&&this.addSearchColumn(),this.displayBloc.info&&this.addInfoControls(),this.displayBloc.paging&&(this.addPaginationControls(),this.paginate())}createWrappers(){this.table.classList.add("tableBeautifuller"),this.paginationWrapperTopContainer=document.createElement("div"),this.paginationWrapperTopContainer.classList.add("tableBeautifuller","pagination-wrapper-top-container"),this.table.parentNode.insertBefore(this.paginationWrapperTopContainer,this.table),this.paginationWrapperDownContainer=document.createElement("div"),this.paginationWrapperDownContainer.classList.add("tableBeautifuller","pagination-down-container"),this.table.parentNode.appendChild(this.paginationWrapperDownContainer)}debounce(t,e){let a;return function(){const n=this,i=arguments;clearTimeout(a),a=setTimeout((()=>t.apply(n,i)),e)}}addSearchInput(){this.searchInput=document.createElement("input"),this.searchInput.setAttribute("type","text"),this.searchInput.setAttribute("placeholder","Recherche..."),this.searchInput.className="search-input",this.paginationWrapperTopContainer.appendChild(this.searchInput),this.searchInput.addEventListener("keyup",this.debounce((()=>{this.searchTable(null,this.searchInput.value)}),this.debounce_delai))}addSearchColumn(){let t=document.createElement("tr");t.classList.add("thead-search"),this.table.querySelectorAll("th").forEach((e=>{let a=document.createElement("th");switch(e.getAttribute("data-search")??""){case"input":let t=document.createElement("input");t.type="text",t.addEventListener("input",this.debounce((t=>{this.searchTable(e.cellIndex,t.target.value)}),this.debounce_delai)),a.appendChild(t);break;case"combobox":let n=document.createElement("select"),i=this.getUniqueValuesForColumn(e.cellIndex);n.innerHTML='<option value="">Tout</option>',i.forEach((t=>{let e=document.createElement("option");e.value=t,e.textContent=t,n.appendChild(e)})),n.addEventListener("change",this.debounce((t=>{this.searchTable(e.cellIndex,t.target.value)}),this.debounce_delai)),a.appendChild(n);break;default:return}t.appendChild(a)})),this.table.querySelector("thead").appendChild(t)}getUniqueValuesForColumn(t){let e=[];return this.table.querySelector("tbody").querySelectorAll("tr").forEach((a=>{let n=a.cells[t].textContent.trim();e.includes(n)||e.push(n)})),e}addSortingArrows(){this.table.querySelectorAll("th").forEach(((t,e)=>{t.dataset.sort="none";let a=document.createElement("span");a.classList.add("sort-arrow"),t.appendChild(a);let n=this.headerClickHandler.bind(this,t,e);t._sortingHandler=n,t.addEventListener("click",n)}))}headerClickHandler(t,e){let a="asc"===t.dataset.sort?"desc":"asc";this.sortTable(e,a),t.dataset.sort=a,this.updateArrows(t)}updateArrows(t){this.table.querySelectorAll(".sort-arrow").forEach((t=>{t.textContent=""})),t.querySelector(".sort-arrow").textContent="asc"===t.dataset.sort?"▲":"▼"}detectColumnType(t){let e=this.table.querySelector("tbody").querySelectorAll("tr");for(let a=0;a<e.length;a++)if(e[a].cells[t]){let n=e[a].cells[t].hasAttribute("data-order")?e[a].cells[t].getAttribute("data-order"):e[a].cells[t].textContent.trim();if(!isNaN(n))return"number"}return"string"}sortTable(t,e){let a=this.detectColumnType(t),n=Array.from(this.table.querySelector("tbody").querySelectorAll("tr"));n.sort(((n,i)=>{let r=n.cells[t].hasAttribute("data-order")?n.cells[t].getAttribute("data-order"):n.cells[t].textContent.trim(),s=i.cells[t].hasAttribute("data-order")?i.cells[t].getAttribute("data-order"):i.cells[t].textContent.trim();return"number"===a?"asc"===e?r-s:s-r:"asc"===e?r.localeCompare(s):s.localeCompare(r)})),this.table.querySelector("tbody").append(...n)}applyInitialOrder(){this.initialOrder.forEach((t=>{let[e,a]=t;this.sortTable(e,a.toLowerCase());let n=this.table.querySelector(`th:nth-child(${e+1})`);n.dataset.sort=a.toLowerCase(),this.updateArrows(n)}))}searchTable(t,e){let a=null==t?"global":t;""!=e.trim()?this.filters[a]=e.toLowerCase():delete this.filters[a];let n=this.table.querySelectorAll("tbody tr");n.forEach((t=>{t.dataset.matched="true",t.style.display=""})),n.forEach((t=>{for(const[e,a]of Object.entries(this.filters)){if("true"!==t.dataset.matched)return;let n="";if("global"!==e){let a=t.cells[parseInt(e)];n=a.hasAttribute("data-search")?a.getAttribute("data-search"):a.textContent}else{let e=Array.from(t.getElementsByTagName("td"));n=Array.from(e).map((t=>t.hasAttribute("data-search")?t.getAttribute("data-search"):t.textContent)).join(" ")}-1===n.trim().toLowerCase().indexOf(a)&&(t.style.display="none",t.dataset.matched="false")}})),this.currentPage=1,this.paginate()}paginate(){let t=Array.from(this.table.querySelectorAll("tbody tr")).filter((t=>"false"!==t.dataset.matched)).length,e=Math.ceil(t/this.pageLength),a=(this.currentPage-1)*this.pageLength,n=a+this.pageLength;if(this.displayBloc.info){let e=n>t?t:n;this.infoLabel.textContent=`Affichage de l'élément ${a+1} à ${e} sur ${t} éléments`}this.prevButton.disabled=this.currentPage<=1,this.nextButton.disabled=this.currentPage>=e,Array.from(this.table.querySelectorAll("tbody tr")).filter((t=>"false"!==t.dataset.matched)).forEach(((t,e)=>{t.style.display=e<a||e>=n?"none":""})),this.paginationButtonsContainer.querySelectorAll(".page-btn").forEach((t=>{this.paginationButtonsContainer.removeChild(t)}));let i=Math.max(1,this.currentPage-3),r=Math.min(e,this.currentPage+3)-1,s=this.paginationButtonsContainer.lastElementChild;for(let t=i-1;t<=r;t++){let e=i+t,a=document.createElement("button");a.textContent=e,a.setAttribute("data-page",e),a.className="page-btn",a.classList.toggle("active",e===this.currentPage),this.paginationButtonsContainer.insertBefore(a,s)}}addInfoControls(){this.infoLabel=document.createElement("span"),this.infoLabel.className="pagination-info",this.paginationWrapperDownContainer.appendChild(this.infoLabel)}addPaginationControls(){this.paginationWrapperTop=document.createElement("div"),this.paginationWrapperTop.className="pagination-wrapper-top",this.paginationInfoTop=document.createElement("span"),this.paginationInfoTop.textContent="Afficher",this.paginationWrapperTop.appendChild(this.paginationInfoTop),this.paginationSelect=document.createElement("select"),this.selectItemPage.forEach((t=>{let e=document.createElement("option");e.value=t,e.textContent=t,e.selected=t===this.pageLength,this.paginationSelect.appendChild(e)})),this.paginationSelect.value=this.pageLength,this.paginationWrapperTop.appendChild(this.paginationSelect),this.paginationInfoTopAfter=document.createElement("span"),this.paginationInfoTopAfter.textContent="éléments",this.paginationWrapperTop.appendChild(this.paginationInfoTopAfter),this.paginationWrapperTopContainer.appendChild(this.paginationWrapperTop),this.paginationButtonsContainer=document.createElement("div"),this.paginationButtonsContainer.className="pagination-buttons-container",this.prevButton=document.createElement("button"),this.prevButton.textContent="Précédent",this.prevButton.className="page-prev",this.paginationButtonsContainer.appendChild(this.prevButton),this.nextButton=document.createElement("button"),this.nextButton.textContent="Suivant",this.nextButton.className="page-next",this.paginationButtonsContainer.appendChild(this.nextButton),this.paginationWrapperDownContainer.appendChild(this.paginationButtonsContainer),this.paginationSelect.addEventListener("change",(()=>{this.pageLength=parseInt(this.paginationSelect.value),this.currentPage=1,this.paginate()})),this.paginationButtonsContainer.addEventListener("click",(t=>{let e=t.target.classList;e.contains("page-btn")?this.currentPage=parseInt(t.target.getAttribute("data-page")):e.contains("page-prev")?this.currentPage--:e.contains("page-next")&&this.currentPage++,this.paginate()}))}destroy(){this.searchInput&&this.searchInput.remove(),this.table.querySelectorAll("th").forEach((t=>{t._sortingHandler&&(t.removeEventListener("click",t._sortingHandler),delete t._sortingHandler);let e=t.querySelector(".sort-arrow");e&&e.remove()})),this.table.querySelectorAll("tbody tr").forEach((t=>{t.style.display=""})),this.paginationWrapperTopContainer&&this.paginationWrapperTopContainer.remove(),this.paginationWrapperDownContainer&&this.paginationWrapperDownContainer.remove();let t=this.table.querySelector(".thead-search");t&&t.remove()}}
//# sourceMappingURL=TableBeautifuller.min.js.map
